name: Tag images

on:
  push:
    branches:
      - '*'
    tags:
      - '*'

env:
  GO_VERSION: 1.16
  JAVA_VERSION: 11
  TAG_EVENT: ${{ true }}

jobs:
  push_images:
    name: Push images
    runs-on: ubuntu-latest
    if: ${{ github.event_name != 'pull_request' }}
    steps:
    - id: version
      name: Infer version
      run: |
        version="${GITHUB_REF#refs/tags/v}"
        echo $version
        if  [[ $version == refs/* ]] ;
        then
            echo 'TAG_EVENT=false' >> $GITHUB_ENV
            branch="${GITHUB_REF#refs/heads/}"
            version=$branch
            
        fi
        echo $version
        echo ::set-output name=version::$version
    - name: Publish images
      if: github.event_name != 'pull_request' && !startsWith (steps.version.outputs.version,'releases') && steps.version.outputs.version != 'site'
      env:
        DOCKER_PUBLIC_TAGNAME:  ${{ steps.version.outputs.version }}
      run: |
        echo ${DOCKER_PUBLIC_TAGNAME}
        echo ${TAG_EVENT}
        echo "here!!"
    - name: Publish latest image tag for release
      if: github.event_name != 'pull_request' && env.TAG_EVENT == 'true'
      env:
        DOCKER_PUBLIC_TAGNAME: latest
      run: |
        echo ${DOCKER_PUBLIC_TAGNAME}
        echo ${TAG_EVENT}
        echo "revit!!!"

